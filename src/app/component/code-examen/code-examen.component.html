<div class="container-entrainement">

  <h2 class="main-title">ğŸ“˜ Gestion des examens de code</h2>

  <!-- vÃ©rification moyenne scores entrainement -->
  <section class="bloc-section">
    <h3 class="section-title">ğŸ“Š Statut d'Ã©ligibilitÃ©</h3>
    <p>Moyenne actuelle : <strong>{{ moyenne.toFixed(2) }}/40</strong></p>

    <button (click)="ouvrirFormulaire()" [disabled]="!peutReserver" class="btn btn-primary">
      RÃ©server une session
    </button>

    <span *ngIf="!peutReserver" class="text-danger">Moyenne minimale requise : 32</span>
    <span *ngIf="showConfirmation" class="confirmation">RÃ©servation confirmÃ©e</span>
  </section>

  <!-- exams Ã  venir -->
  <section class="bloc-section">
    <h3 class="section-title">â³ Examens Ã  venir</h3>
    <div *ngIf="examensAvenir.length === 0">Aucune rÃ©servation en cours.</div>

    <div *ngFor="let exam of examensAvenir" class="result-card">
      <div class="infos">
        <p><strong>Date :</strong> {{ exam.date_passage | date:'dd/MM/yyyy' }}</p>
        <p><strong>Centre :</strong> {{ exam.centre }}</p>
        <p><strong>CrÃ©neau :</strong> {{ exam.creneau }}</p>
      </div>
      <div class="actions">
        <button class="btn btn-outline" (click)="ouvrirDetailAvenir(exam)">DÃ©tails</button>
        <button class="btn btn-danger" (click)="supprimerReservation(exam.id)">Annuler</button>
      </div>
    </div>
  </section>

  <!-- exams passÃ©s -->
  <section class="bloc-section">
    <h3 class="section-title">âœ… Examens passÃ©s</h3>
    <div *ngIf="examensPasses.length === 0">Aucun examen passÃ©.</div>

    <div *ngFor="let exam of examensPasses" class="result-card">
      <div class="infos">
        <p><strong>Date :</strong> {{ (exam.date || exam.date_passage) | date:'dd/MM/yyyy' }}</p>
        <p><strong>Score :</strong> {{ exam.score }}/40</p>
      </div>
      <div class="actions">
        <button class="btn btn-outline" (click)="ouvrirDetailPasse(exam)">DÃ©tails</button>
        <button class="btn btn-primary" (click)="ouvrirAvis()">Donner un avis</button>
      </div>
    </div>
  </section>

  <!-- rÃ©servation de session -->
  <div *ngIf="formVisible" class="modal-backdrop">
    <div class="modal-content-entrainement">
      <div class="modal-header">
        <div class="modal-title">RÃ©server une session</div>
        <button class="btn-close" (click)="fermerFormulaire()">Ã—</button>
      </div>
      <div class="modal-body">
        <label>Date :</label>
        <input type="date" [(ngModel)]="formData.date_passage" />

        <label>CrÃ©neau :</label>
        <select [(ngModel)]="formData.creneau">
          <option *ngFor="let c of creneaux" [value]="c">{{ c }}</option>
        </select>

        <label>Centre :</label>
        <input type="text" [(ngModel)]="formData.centre" />

        <div class="popup-actions">
          <button class="btn btn-success" (click)="validerReservation()">Valider</button>
          <button class="btn btn-danger" (click)="fermerFormulaire()">Annuler</button>
        </div>
      </div>
    </div>
  </div>

  <!-- avis -->
  <div *ngIf="popupAvisVisible" class="modal-backdrop">
    <div class="modal-content-entrainement">
      <div class="modal-header">
        <div class="modal-title">Laisser un avis</div>
        <button class="btn-close" (click)="fermerAvis()">Ã—</button>
      </div>
      <div class="modal-body">
        <label>Note :</label>
        <div class="stars">
          <span *ngFor="let star of [1,2,3,4,5]" 
                (click)="setStars(star)" 
                [class.filled]="star <= selectedStars">
            â˜…
          </span>
        </div>

        <label>Commentaire :</label>
        <textarea [(ngModel)]="avisCommentaire" rows="3" placeholder="Votre retour..."></textarea>

        <div class="popup-actions">
          <button class="btn btn-success" (click)="envoyerAvis()">Envoyer</button>
          <button class="btn btn-danger" (click)="fermerAvis()">Annuler</button>
        </div>
      </div>
    </div>
  </div>

  <!-- dÃ©tails des sessions Ã  venis -->
  <div *ngIf="detailAvenir" class="modal-backdrop">
    <div class="modal-content-entrainement">
      <div class="modal-header">
        <div class="modal-title">DÃ©tail de la session Ã  venir</div>
        <button class="btn-close" (click)="fermerDetailAvenir()">Ã—</button>
      </div>
      <div class="modal-body">
        <p><strong>Date :</strong> {{ detailAvenir.date_passage | date:'dd/MM/yyyy' }}</p>
        <p><strong>Centre :</strong> {{ detailAvenir.centre }}</p>
        <p><strong>CrÃ©neau :</strong> {{ detailAvenir.creneau }}</p>
      </div>
    </div>
  </div>

  <!-- dÃ©tails exams passÃ©s -->
  <div *ngIf="detailPasse" class="modal-backdrop">
    <div class="modal-content-entrainement">
      <div class="modal-header">
        <div class="modal-title">DÃ©tail de l'examen passÃ©</div>
        <button class="btn-close" (click)="fermerDetailPasse()">Ã—</button>
      </div>
      <div class="modal-body">
        <p><strong>Date :</strong> {{ (detailPasse.date || detailPasse.date_passage) | date:'dd/MM/yyyy' }}</p>
        <p><strong>Score :</strong> {{ detailPasse.score }}/40</p>
      </div>
    </div>
  </div>

</div>
